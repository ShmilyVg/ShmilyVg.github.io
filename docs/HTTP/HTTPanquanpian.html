<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>HTTP安全篇 | 奈落Kaniの净土</title><meta name="description" content="My doc blog">
    <link rel="modulepreload" href="/assets/app-bb01d446.js"><link rel="modulepreload" href="/assets/framework-eb6cfbb5.js"><link rel="modulepreload" href="/assets/HTTPanquanpian.html-856b1e20.js"><link rel="modulepreload" href="/assets/HTTPanquanpian.html-aaa86b3f.js"><link rel="prefetch" href="/assets/index.html-6d5e9dd3.js" as="script"><link rel="prefetch" href="/assets/index.html-8c2edf06.js" as="script"><link rel="prefetch" href="/assets/index.html-4e5ab0a1.js" as="script"><link rel="prefetch" href="/assets/index.html-97c1c024.js" as="script"><link rel="prefetch" href="/assets/index.html-c4d32c30.js" as="script"><link rel="prefetch" href="/assets/index.html-9a075765.js" as="script"><link rel="prefetch" href="/assets/index.html-a2c706b5.js" as="script"><link rel="prefetch" href="/assets/index.html-5b18d14f.js" as="script"><link rel="prefetch" href="/assets/index.html-8c6eaa2a.js" as="script"><link rel="prefetch" href="/assets/index.html-7c115369.js" as="script"><link rel="prefetch" href="/assets/index.html-69254cc3.js" as="script"><link rel="prefetch" href="/assets/index.html-075c60da.js" as="script"><link rel="prefetch" href="/assets/index.html-be5f658b.js" as="script"><link rel="prefetch" href="/assets/index.html-60aa2b86.js" as="script"><link rel="prefetch" href="/assets/index.html-94649f43.js" as="script"><link rel="prefetch" href="/assets/index.html-a43625e0.js" as="script"><link rel="prefetch" href="/assets/index.html-6cf06f14.js" as="script"><link rel="prefetch" href="/assets/index.html-e9570967.js" as="script"><link rel="prefetch" href="/assets/gitshiyongjiqiao.html-8a9e1d9e.js" as="script"><link rel="prefetch" href="/assets/markdownyufalianxi.html-ef4db490.js" as="script"><link rel="prefetch" href="/assets/Mysqlminglingxingzhiling.html-3b4e8ed9.js" as="script"><link rel="prefetch" href="/assets/ReactHookschutan.html-9c9c2347.js" as="script"><link rel="prefetch" href="/assets/chujisuanfa.html-0de5483b.js" as="script"><link rel="prefetch" href="/assets/qianduancuowubuhuohechuli.html-e7ae435c.js" as="script"><link rel="prefetch" href="/assets/shixiankaifaguifanhua.html-b34407d2.js" as="script"><link rel="prefetch" href="/assets/zhengzebiaodashiji.html-eec6caeb.js" as="script"><link rel="prefetch" href="/assets/xuniliebiao.html-723803af.js" as="script"><link rel="prefetch" href="/assets/HTTPjichupian.html-f38d80cb.js" as="script"><link rel="prefetch" href="/assets/HTTPjinjiepian.html-c4e38af9.js" as="script"><link rel="prefetch" href="/assets/HTTPfeixiangpian.html-c91c04a8.js" as="script"><link rel="prefetch" href="/assets/api.html-207231c6.js" as="script"><link rel="prefetch" href="/assets/home.html-75efa07a.js" as="script"><link rel="prefetch" href="/assets/plugin.html-cac2c509.js" as="script"><link rel="prefetch" href="/assets/theme.html-a824e996.js" as="script"><link rel="prefetch" href="/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/assets/index.html-653a3c72.js" as="script"><link rel="prefetch" href="/assets/index.html-f994e29b.js" as="script"><link rel="prefetch" href="/assets/index.html-ac3cd5b9.js" as="script"><link rel="prefetch" href="/assets/index.html-f72d892f.js" as="script"><link rel="prefetch" href="/assets/index.html-87baffa2.js" as="script"><link rel="prefetch" href="/assets/index.html-d443ae4c.js" as="script"><link rel="prefetch" href="/assets/index.html-ccb9aa17.js" as="script"><link rel="prefetch" href="/assets/index.html-7f74f8da.js" as="script"><link rel="prefetch" href="/assets/index.html-5153d404.js" as="script"><link rel="prefetch" href="/assets/index.html-6a1cdab7.js" as="script"><link rel="prefetch" href="/assets/index.html-fbe07652.js" as="script"><link rel="prefetch" href="/assets/index.html-d262cb24.js" as="script"><link rel="prefetch" href="/assets/index.html-ecc53b57.js" as="script"><link rel="prefetch" href="/assets/index.html-04ddfda3.js" as="script"><link rel="prefetch" href="/assets/index.html-d36eb654.js" as="script"><link rel="prefetch" href="/assets/index.html-fc715d75.js" as="script"><link rel="prefetch" href="/assets/index.html-7f406e8f.js" as="script"><link rel="prefetch" href="/assets/index.html-1ebf9179.js" as="script"><link rel="prefetch" href="/assets/gitshiyongjiqiao.html-5718f612.js" as="script"><link rel="prefetch" href="/assets/markdownyufalianxi.html-4880cc29.js" as="script"><link rel="prefetch" href="/assets/Mysqlminglingxingzhiling.html-5e3de743.js" as="script"><link rel="prefetch" href="/assets/ReactHookschutan.html-ee8a6c63.js" as="script"><link rel="prefetch" href="/assets/chujisuanfa.html-c98a8635.js" as="script"><link rel="prefetch" href="/assets/qianduancuowubuhuohechuli.html-1b390c5b.js" as="script"><link rel="prefetch" href="/assets/shixiankaifaguifanhua.html-197b83b9.js" as="script"><link rel="prefetch" href="/assets/zhengzebiaodashiji.html-05d815c7.js" as="script"><link rel="prefetch" href="/assets/xuniliebiao.html-9e3e3381.js" as="script"><link rel="prefetch" href="/assets/HTTPjichupian.html-727df73b.js" as="script"><link rel="prefetch" href="/assets/HTTPjinjiepian.html-e07f1383.js" as="script"><link rel="prefetch" href="/assets/HTTPfeixiangpian.html-7d0b45b3.js" as="script"><link rel="prefetch" href="/assets/api.html-3d24d317.js" as="script"><link rel="prefetch" href="/assets/home.html-96c132cb.js" as="script"><link rel="prefetch" href="/assets/plugin.html-84e4e896.js" as="script"><link rel="prefetch" href="/assets/theme.html-d75304e0.js" as="script"><link rel="prefetch" href="/assets/404.html-480940ac.js" as="script"><link rel="prefetch" href="/assets/reco-valine-a0c1af1f.js" as="script">
    <link rel="preload" href="/assets/style-6533c42a.css" as="style"><link rel="stylesheet" href="/assets/style-6533c42a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper show-series show-catalog"><div><header class="navbar-container" style="top:0;"><div class="site-brand nav-item"><!----><a href="/" class="site-name">奈落Kaniの净土</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/categories/qianduan/1/" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/zhengze/1/" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="技术"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="技术"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/docs/http/HTTP基础篇.md" class="link" aria-label="HTTP"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a class="link" href="https://github.com/ShmilyVg" target="_blank" rel="noopener noreferrer"><!--[--><!--]--><span class="xicon-container"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></header><header class="sub-navbar-container"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div> Series </span></header><div class="mobile-menus-container"><nav class="navbar-links mobile"><!--[--><div class="navbar-links__item"><a href="/categories/qianduan/1/" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/zhengze/1/" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="技术"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="技术"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/docs/http/HTTP基础篇.md" class="link" aria-label="HTTP"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a class="link" href="https://github.com/ShmilyVg" target="_blank" rel="noopener noreferrer"><!--[--><!--]--><span class="xicon-container"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><div class="appearance"><span>Appearance</span><span class="xicon-container btn-toggle-dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span></div></div><div class="series-mask"></div><aside class="series-container"><div class="site-brand"><!----><a href="/" class="site-name">奈落Kaniの净土</a></div><!--[--><!--[--><a href="/docs/HTTP/HTTPjichupian.html" class="link series-item" aria-label="HTTP基础篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP基础篇<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html" class="router-link-active router-link-exact-active link router-link-active series-item active" aria-label="HTTP安全篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP安全篇<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/docs/HTTP/HTTPjinjiepian.html" class="link series-item" aria-label="HTTP进阶篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP进阶篇<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/docs/HTTP/HTTPfeixiangpian.html" class="link series-item" aria-label="HTTP飞翔篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP飞翔篇<!--]--></span></span><!--[--><!--]--></a><!--]--><!--]--></aside><!--[--><main class="page-container"><h1 class="page-title">HTTP安全篇</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Kani<!--]--></span></span><!----><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法<!--]--></span></span><!----></div><div class="theme-reco-default-content"><div><h1 id="tls-是什么" tabindex="-1"><a class="header-anchor" href="#tls-是什么" aria-hidden="true">#</a> TLS 是什么</h1><h2 id="什么是安全" tabindex="-1"><a class="header-anchor" href="#什么是安全" aria-hidden="true">#</a> 什么是安全</h2><p>通信过程具备了四个特性，就可以认为是“安全”的，这四个特性是：机密性、完整性，身份认证和不可否认。</p><p><strong>机密性</strong>：是指对数据的“保密”，只能由可信的人访问</p><p><strong>完整性</strong>：是指数据在传输过程中没有被窜改，不多也不少</p><p><strong>身份认证</strong>：是指确认对方的真实身份</p><p><strong>不可否认</strong>：也叫不可抵赖，意思是不能否认已经发生过的行为</p><p><strong>“https”，默认端口号 443</strong>，其他都完全沿用 HTTP，没有任何新的东西。</p><p><img src="https://static001.geekbang.org/resource/image/50/a3/50d57e18813e18270747806d5d73f0a3.png" alt=""></p><h2 id="ssl-tls" tabindex="-1"><a class="header-anchor" href="#ssl-tls" aria-hidden="true">#</a> SSL/TLS</h2><p>SSL 即安全套接层（Secure Sockets Layer），在 OSI 模型中处于第 5 层（会话层）</p><p>SSL 发展到 v3 时在 1999 年改名为 TLS</p><h1 id="对称加密与非对称加密" tabindex="-1"><a class="header-anchor" href="#对称加密与非对称加密" aria-hidden="true">#</a> 对称加密与非对称加密</h1><h2 id="对称加密" tabindex="-1"><a class="header-anchor" href="#对称加密" aria-hidden="true">#</a> 对称加密</h2><p>AES（高级加密标准）密钥长度可以是 128、192 或 256。</p><p>ChaCha20 密钥长度固定为 256 位</p><h2 id="非对称加密-运算速度很慢" tabindex="-1"><a class="header-anchor" href="#非对称加密-运算速度很慢" aria-hidden="true">#</a> 非对称加密（运算速度很慢）</h2><p>RSA 它的安全性基于“<strong>整数分解</strong>”的数学难题，使用两个超大素数的乘积作为生成密钥的材料</p><p>ECC 基于“<strong>椭圆曲线离散对数</strong>”的数学难题，使用特定的曲线方程和基点生成公钥和私钥</p><h2 id="混合加密-tls" tabindex="-1"><a class="header-anchor" href="#混合加密-tls" aria-hidden="true">#</a> 混合加密（TLS）</h2><p>通信刚开始的时候使用非对称算法,解决密钥交换的问题。用随机数产生对称算法使用的“<strong>会话密钥</strong>”，再用公钥加密。(会话密钥很短,16/32 字节慢一点也无所谓)。对方拿到密文后用私钥解密，取出会话密钥。这样就实现了对称密钥的安全交换，后续就不再使用非对称加密，全都使用对称加密。</p><p><img src="https://static001.geekbang.org/resource/image/e4/85/e41f87110aeea3e548d58cc35a478e85.png" alt=""></p><h1 id="数字签名与证书" tabindex="-1"><a class="header-anchor" href="#数字签名与证书" aria-hidden="true">#</a> 数字签名与证书</h1><h2 id="摘要算法" tabindex="-1"><a class="header-anchor" href="#摘要算法" aria-hidden="true">#</a> 摘要算法</h2><p>可近似地理解成一种特殊的压缩算法，能够把任意长度的数据“压缩”成固定长度、而且独一无二的“摘要”字符串</p><p>摘要算法对输入具有“单向性”和“雪崩效应”，输入的微小不同会导致输出的剧烈变化</p><p><img src="https://static001.geekbang.org/resource/image/28/d8/2865d2c77466efb7a480833bcb27f9d8.png" alt=""></p><p>常用的摘要算法：MD5、SHA-1</p><h2 id="完整性" tabindex="-1"><a class="header-anchor" href="#完整性" aria-hidden="true">#</a> 完整性</h2><p>摘要算法保证了“数字摘要”和原文是完全等价的。只要在原文后附上它的摘要，就能够保证数据的完整性。</p><p><img src="https://static001.geekbang.org/resource/image/c2/96/c2e10e9afa1393281b5633b1648f2696.png" alt=""></p><h1 id="tls1-2-的连接过程" tabindex="-1"><a class="header-anchor" href="#tls1-2-的连接过程" aria-hidden="true">#</a> TLS1.2 的连接过程</h1><h2 id="tls-协议由子协议组成" tabindex="-1"><a class="header-anchor" href="#tls-协议由子协议组成" aria-hidden="true">#</a> TLS 协议由子协议组成</h2><ul><li>记录协议：规定了 TLS 收发数据的基本单位：记录</li><li>报警协议：向对方发出警报信息</li><li>握手协议：TLS 里最复杂的子协议，要比 TCP 的 SYN/ACK 复杂的多，浏览器和服务器会在握手过程中协商 TLS 版本号、随机数、密码套件等信息，然后交换证书和密钥参数，最终双方协商得到会话密钥，用于后续的混合加密系统。</li><li>变更密码规范协议：告诉对方，后续的数据都将使用加密保护</li></ul><h2 id="ecdhe-握手过程" tabindex="-1"><a class="header-anchor" href="#ecdhe-握手过程" aria-hidden="true">#</a> ECDHE 握手过程</h2><p><img src="https://static001.geekbang.org/resource/image/9c/1e/9caba6d4b527052bbe7168ed4013011e.png" alt=""></p><h2 id="rsa-握手过程" tabindex="-1"><a class="header-anchor" href="#rsa-握手过程" aria-hidden="true">#</a> RSA 握手过程</h2><p><img src="https://static001.geekbang.org/resource/image/cb/d2/cb9a89055eadb452b7835ba8db7c3ad2.png" alt=""></p><h1 id="tls1-3-新特性" tabindex="-1"><a class="header-anchor" href="#tls1-3-新特性" aria-hidden="true">#</a> TLS1.3 新特性</h1><ul><li>为了兼容 1.1、1.2 等“老”协议，TLS1.3 会“伪装”成 TLS1.2，新特性在“扩展”里实现；</li><li>1.1、1.2 在实践中发现了很多安全隐患，所以 TLS1.3 大幅度删减了加密算法，只保留了 ECDHE、AES、ChaCha20、SHA-2 等极少数算法，强化了安全；</li><li>TLS1.3 也简化了握手过程，完全握手只需要一个消息往返，提升了性能。</li></ul><h1 id="https-优化" tabindex="-1"><a class="header-anchor" href="#https-优化" aria-hidden="true">#</a> HTTPS 优化</h1><ul><li>可以有多种硬件和软件手段减少网络耗时和计算耗时，让 HTTPS 变得和 HTTP 一样快，最可行的是软件优化；</li><li>应当尽量使用 ECDHE 椭圆曲线密码套件，节约带宽和计算量，还能实现“False Start”；</li><li>服务器端应当开启“OCSP Stapling”功能，避免客户端访问 CA 去验证证书；</li><li>会话复用的效果类似 Cache，前提是客户端必须之前成功建立连接，后面就可以用“Session ID”“Session Ticket”等凭据跳过密钥交换、证书验证等步骤，直接开始加密通信。</li></ul><h1 id="迁移-https" tabindex="-1"><a class="header-anchor" href="#迁移-https" aria-hidden="true">#</a> 迁移 HTTPS</h1><h2 id="迁移的顾虑" tabindex="-1"><a class="header-anchor" href="#迁移的顾虑" aria-hidden="true">#</a> 迁移的顾虑</h2><ul><li>“慢”，是指惯性思维，拿以前的数据来评估 HTTPS 的性能，认为 HTTPS 会增加服务器的成本，增加客户端的时延，影响用户体验。</li><li>“贵”，主要是指证书申请和维护的成本太高，网站难以承担。</li><li>难”，是指 HTTPS 涉及的知识点太多、太复杂，有一定的技术门槛，不能很快上手。</li></ul><h2 id="从-http-切换到-https-流程" tabindex="-1"><a class="header-anchor" href="#从-http-切换到-https-流程" aria-hidden="true">#</a> 从 HTTP 切换到 HTTPS 流程</h2><p><strong>1.申请证书：Let’s Encrypt（免费，中小型公司适用）</strong></p><p>注意事项：</p><ul><li>申请证书时应当同时申请 RSA 和 ECDSA 两种证书，在 Nginx 里配置成双证书验证，这样服务器可以自动选择快速的椭圆曲线证书，同时也兼容只支持 RSA 的客户端。</li><li>申请 RSA 证书，私钥至少要 2048 位，摘要算法应该选用 SHA-2，如 SHA256、SHA384 等</li><li>出于安全的考虑，“Let’s Encrypt”证书的有效期很短，只有 90 天，时间一到就会过期失效，所以必须要定期更新（在 crontab 里加个每周或每月任务，发送更新请求）</li></ul><p><strong>2.配置 HTTPS</strong></p><p>配置 Web 服务器：nginx 上非常简单，只要在“listen”指令后面加上参数“ssl”，再配上刚才的证书文件就可以实现最基本的 HTTPS</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">listen</span>                <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">ssl_certificate</span>       xxx_rsa.crt</span><span class="token punctuation">;</span>  <span class="token comment">#rsa2048 cert</span>
<span class="token directive"><span class="token keyword">ssl_certificate_key</span>   xxx_rsa.key</span><span class="token punctuation">;</span>  <span class="token comment">#rsa2048 private key</span>

<span class="token directive"><span class="token keyword">ssl_certificate</span>       xxx_ecc.crt</span><span class="token punctuation">;</span>  <span class="token comment">#ecdsa cert</span>
<span class="token directive"><span class="token keyword">ssl_certificate_key</span>   xxx_ecc.key</span><span class="token punctuation">;</span>  <span class="token comment">#ecdsa private ke</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了提高 HTTPS 的安全系数和性能，可以强制 Nginx 只支持 TLS1.2 以上的协议，打开“Session Ticket”会话复用：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">ssl_protocols</span>               TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">ssl_session_timeout</span>         <span class="token number">5m</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_session_tickets</span>         <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_session_ticket_key</span>      ticket.key</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>密码套件的选择方面，以服务器的套件优先，可以避免恶意客户端故意选择较弱的套件、降低安全等级，密码套件向 TLS1.3“看齐”，只使用 ECDHE、AES 和 ChaCha20，支持“False Start”</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>   <span class="token boolean">on</span></span><span class="token punctuation">;</span>


<span class="token directive"><span class="token keyword">ssl_ciphers</span>   ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE+AES128:!MD5:!SHA1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果服务器上使用了 OpenSSL 的分支 BorringSSL，那么还可以使用一个特殊的“等价密码组”（Equal preference cipher groups）特性，它可以让服务器配置一组“等价”的密码套件，在这些套件里允许客户端优先选择，比如这么配置：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">ssl_ciphers</span>
[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>全部配置完成后，可以访问https://www.ssllabs.com/，测试网站的安全程度</p><p><strong>3.服务器名称指示</strong></p><p>在 HTTP 协议里，多个域名可以同时在一个 IP 地址上运行，这就是“虚拟主机”</p><p>在 HTTPS 里，因为请求头只有在 TLS 握手之后才能发送，在握手时就必须选择“虚拟主机”对应的证书，TLS 无法得知域名的信息，就只能用 IP 地址来区分</p><p>解决这个问题得用到 TLS 的“扩展”，给协议加个<strong>SNI</strong>（Server Name Indication）的“补充条款”。它的作用和 Host 字段差不多，客户端会在“Client Hello”时带上域名信息，这样服务器就可以根据名字而不是 IP 地址来选择证书</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code>Extension: server_name (len=19)
    Server Name Indication extension
        Server Name Type: host_name (0)
        Server Name: www.chrono.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4.重定向跳转</strong></p><p>把之前不安全的 HTTP 网址用 301 或 302“重定向”到新的 HTTPS 网站，这在 Nginx 里也很容易做到，使用“return”或“rewrite”都可以。</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>             <span class="token comment"># 永久重定向</span>
<span class="token directive"><span class="token keyword">rewrite</span> ^  https://<span class="token variable">$host</span><span class="token variable">$request_uri</span> permanent</span><span class="token punctuation">;</span>   <span class="token comment"># 永久重定向</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这种方式有<strong>两个问题</strong>一个是重定向增加了网络成本，多出了一次请求；另一个是存在安全隐患，重定向的响应可能会被“中间人”窜改，实现“会话劫持”，跳转到恶意网站。</p><p>“<strong>HSTS</strong>”（HTTP 严格传输安全，HTTP Strict Transport Security）的技术可以消除这种安全隐患。HTTPS 服务器需要在发出的响应头里添加一个“<strong>Strict-Transport-Security</strong>”的字段，再设定一个有效期，例如：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Strict-Transport-Security:</span> max-age=15768000</span><span class="token punctuation">;</span> includeSubDomains
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有了“HSTS”的指示，以后浏览器再访问同样的域名的时候就会自动把 URI 里的“http”改成“https”，直接访问安全的 HTTPS 网站。这样“中间人”就失去了攻击的机会，而且对于客户端来说也免去了一次跳转，加快了连接速度。</p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Last Updated 2023/5/23 22:41:01<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← HTTP基础篇</span><span class="page-nav-item next">HTTP进阶篇 → </span></p></nav><!----></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#什么是安全" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="什么是安全"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->什么是安全<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#ssl-tls" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="SSL/TLS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->SSL/TLS<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#对称加密" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="对称加密"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->对称加密<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#非对称加密-运算速度很慢" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="非对称加密（运算速度很慢）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->非对称加密（运算速度很慢）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#混合加密-tls" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="混合加密（TLS）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->混合加密（TLS）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#摘要算法" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="摘要算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->摘要算法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#完整性" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="完整性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->完整性<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#tls-协议由子协议组成" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="TLS 协议由子协议组成"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->TLS 协议由子协议组成<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#ecdhe-握手过程" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="ECDHE 握手过程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->ECDHE 握手过程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#rsa-握手过程" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="RSA 握手过程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->RSA 握手过程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#迁移的顾虑" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="迁移的顾虑"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->迁移的顾虑<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/HTTP/HTTPanquanpian.html#从-http-切换到-https-流程" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="从 HTTP 切换到 HTTPS 流程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->从 HTTP 切换到 HTTPS 流程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-bb01d446.js" defer></script>
  </body>
</html>
